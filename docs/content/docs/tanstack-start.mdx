---
title: TanStack Start Integration
description: Complete guide to integrating generate-metadata with TanStack Start applications
---

# TanStack Start Integration

Learn how to integrate generate-metadata with your TanStack Start application for dynamic, AI-powered SEO metadata generation.

## Installation

First, ensure you have generate-metadata installed:

```bash
npm install generate-metadata
```

## Setup

### 1. Create a Metadata Client

Create a shared client instance that you can use throughout your application:

```ts title="lib/metadata.ts"
import { GenerateMetadataClient } from "generate-metadata/tanstack-start";

export const metadataClient = new GenerateMetadataClient({
  dsn: process.env.GENERATE_METADATA_DSN,
});
```

### 2. Environment Configuration

Add your DSN to your environment variables:

```bash title=".env"
GENERATE_METADATA_DSN=your_dsn_here
```

<Callout type="info">
  TanStack Start runs on the server, so you don't need the `NEXT_PUBLIC_`
  prefix.
</Callout>

## Route Head Metadata

Use the `getHead` method to generate head metadata for individual routes:

```tsx title="routes/index.tsx"
import { metadataClient } from "@/lib/metadata";

export const head = metadataClient.getHead(() => ({
  path: "/",
  fallback: {
    meta: [
      { name: "title", content: "Home - My App" },
      { name: "description", content: "Welcome to my application" },
      { name: "robots", content: "index,follow" },
    ],
  },
  override: {
    meta: [
      { name: "viewport", content: "width=device-width, initial-scale=1" },
    ],
  },
}));

export default function HomePage() {
  return (
    <div>
      <h1>Welcome to My App</h1>
      <p>This page will have AI-optimized metadata!</p>
    </div>
  );
}
```

## Dynamic Routes

For dynamic routes, use the route context to generate path-specific metadata:

```tsx title="routes/blog.$slug.tsx"
import { metadataClient } from "@/lib/metadata";
import { getRouteApi } from "@tanstack/react-start";

const routeApi = getRouteApi("/blog/$slug");

export const head = metadataClient.getHead((ctx) => {
  const { slug } = routeApi.useParams();

  return {
    path: `/blog/${slug}`,
    fallback: {
      meta: [
        { name: "title", content: "Blog Post - My App" },
        { name: "description", content: "Read our latest blog post" },
        { property: "og:type", content: "article" },
      ],
    },
  };
});

export default function BlogPost() {
  const { slug } = routeApi.useParams();

  return (
    <article>
      <h1>Blog Post: {slug}</h1>
      <p>Content goes here...</p>
    </article>
  );
}
```

## Root Layout Metadata

Use `getRootHead` for layout-level metadata that applies to multiple routes:

```tsx title="routes/__root.tsx"
import { metadataClient } from "@/lib/metadata";

export const head = metadataClient.getRootHead(() => ({
  path: "/",
  fallback: {
    meta: [
      { name: "title", content: "My App" },
      { name: "description", content: "The best app on the internet" },
      { name: "theme-color", content: "#000000" },
    ],
    links: [{ rel: "icon", href: "/favicon.ico" }],
  },
}));

// ... rest of root component
```

## Head Structure

TanStack Start uses a specific head structure with arrays for meta tags and links:

```tsx
export const head = metadataClient.getHead(() => ({
  path: "/products",
  fallback: {
    meta: [
      { name: "title", content: "Products" },
      { name: "description", content: "Browse our products" },
      { property: "og:title", content: "Products - My Store" },
      { property: "og:description", content: "Browse our amazing products" },
      { property: "og:image", content: "https://myapp.com/og-image.jpg" },
      { name: "twitter:card", content: "summary_large_image" },
      { name: "twitter:title", content: "Products - My Store" },
    ],
    links: [
      { rel: "canonical", href: "https://myapp.com/products" },
      { rel: "icon", href: "/favicon-32x32.png", sizes: "32x32" },
    ],
  },
}));
```

## Priority & Deduplication

Priority order:

1. **Override** - Always wins
2. **Generated** - From API
3. **Fallback** - When API fails

### Meta Array Deduplication

Meta tags are automatically deduplicated based on their identifying attributes:

```tsx
export const head = metadataClient.getHead(() => ({
  path: "/",
  fallback: {
    meta: [{ name: "description", content: "Fallback description" }],
  },
  override: {
    meta: [
      { name: "description", content: "Override description" }, // This wins
    ],
  },
  // Final result will only contain the override description
}));
```

**Deduplication Rules:**

- `name` attribute: Deduplicated by `name:${value}`
- `property` attribute: Deduplicated by `property:${value}`
- `title` attribute: Deduplicated by `title`
- No identifying attributes: Not deduplicated (preserved as-is)

## Advanced Configuration

### Social Media Optimization

The library automatically converts API responses to appropriate meta tags:

```tsx
export const head = metadataClient.getHead(() => ({
  path: "/products/new-product",
  fallback: {
    meta: [
      { name: "title", content: "New Product Launch" },
      { name: "description", content: "Check out our latest product" },
      { property: "og:title", content: "New Product Launch" },
      { property: "og:description", content: "Check out our latest product" },
      { property: "og:image", content: "https://myapp.com/og-image.jpg" },
      { property: "og:image:alt", content: "New Product" },
      { name: "twitter:card", content: "summary_large_image" },
      { name: "twitter:title", content: "New Product Launch" },
      { name: "twitter:description", content: "Check out our latest product" },
      { name: "twitter:image", content: "https://myapp.com/twitter-image.jpg" },
    ],
  },
}));
```

### Favicon Support

Add favicons and other link elements:

```tsx
export const head = metadataClient.getHead(() => ({
  path: "/",
  fallback: {
    links: [
      { rel: "icon", href: "/favicon.ico" },
      { rel: "icon", href: "/favicon-16x16.png", sizes: "16x16" },
      { rel: "icon", href: "/favicon-32x32.png", sizes: "32x32" },
      {
        rel: "apple-touch-icon",
        href: "/apple-touch-icon.png",
        sizes: "180x180",
      },
    ],
  },
}));
```

### Error Handling

The library gracefully handles API failures by falling back to your provided metadata:

```tsx
export const head = metadataClient.getHead(() => ({
  path: "/contact",
  fallback: {
    meta: [
      { name: "title", content: "Contact Us - My App" },
      { name: "description", content: "Get in touch with our team" },
    ],
  },
  // If API fails, fallback metadata will be used
}));
```

## Development Mode

During development, you can disable API calls by setting `dsn` to `undefined`:

```ts title="lib/metadata.ts"
export const metadataClient = new GenerateMetadataClient({
  dsn:
    process.env.NODE_ENV === "development"
      ? undefined
      : process.env.GENERATE_METADATA_DSN,
});
```

## TypeScript Support

The library provides full TypeScript support with TanStack Start types:

```tsx
import type { RouteContext } from "@tanstack/react-start";

export const head = metadataClient.getHead(
  (
    ctx: RouteContext,
  ): {
    path: string;
    fallback?: TanstackHead;
    override?: TanstackHead;
  } => ({
    path: `/user/${ctx.params.id}`,
    fallback: {
      meta: [
        { name: "title", content: "User Profile" },
        { name: "description", content: "View user profile information" },
      ],
    },
  }),
);
```

## Performance Considerations

### Caching

The library automatically caches API responses based on the path parameter:

- Same path = cached response (no additional API call)
- Different paths = separate cache entries
- Cache persists for the lifetime of the client instance

### Bundle Size

Only import the TanStack Start adapter to keep your bundle size minimal:

```ts
// ✅ Good - only imports TanStack Start adapter
import { GenerateMetadataClient } from "generate-metadata/tanstack-start";

// ❌ Avoid - imports all adapters
import { GenerateMetadataClient } from "generate-metadata";
```

## Examples

### E-commerce Product Page

```tsx title="routes/products.$id.tsx"
import { metadataClient } from "@/lib/metadata";
import { getRouteApi } from "@tanstack/react-start";

const routeApi = getRouteApi("/products/$id");

export const head = metadataClient.getHead(() => {
  const { id } = routeApi.useParams();

  return {
    path: `/products/${id}`,
    fallback: {
      meta: [
        { name: "title", content: "Product - My Store" },
        { name: "description", content: "View product details and purchase" },
        { property: "og:type", content: "product" },
        { name: "robots", content: "index,follow" },
      ],
    },
  };
});
```

### Blog Article with Author

```tsx title="routes/blog.$slug.tsx"
import { metadataClient } from "@/lib/metadata";
import { getRouteApi } from "@tanstack/react-start";

const routeApi = getRouteApi("/blog/$slug");

export const head = metadataClient.getHead(() => {
  const { slug } = routeApi.useParams();

  return {
    path: `/blog/${slug}`,
    fallback: {
      meta: [
        { name: "title", content: "Blog Post - My Blog" },
        {
          name: "description",
          content: "Read our latest insights and updates",
        },
        { property: "og:type", content: "article" },
        { property: "article:author", content: "My Blog Team" },
        { name: "twitter:card", content: "summary_large_image" },
      ],
    },
  };
});
```

## Troubleshooting

### Common Issues

**Meta tags not appearing**: Check that your head function is properly exported and the route is rendering.

**Duplicate meta tags**: The library automatically deduplicates, but ensure you're not adding the same meta tags elsewhere.

**API errors**: Verify your DSN is correct and check the server console for error messages.

### Debug Mode

Enable detailed logging by checking the server console for warnings about failed API calls.

## Next Steps

<Cards>
  <Card
    title="Examples"
    href="/docs/examples"
    description="See real-world usage examples"
  />
  <Card
    title="Troubleshooting"
    href="/docs/troubleshooting"
    description="Solve common issues and problems"
  />
</Cards>
